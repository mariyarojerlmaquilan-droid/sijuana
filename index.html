<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login + Sign Up</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial, sans-serif; margin:0; background:#c3aab6; }
.box {
    max-width:350px; margin:80px auto; background:white; padding:25px; border-radius:8px;
    text-align:center; box-shadow:0 0 10px rgba(0,0,0,0.15);
}
input { width:90%; padding:12px; margin:10px 0; border:1px solid #ccc; border-radius:6px; }
button { width:100%; padding:12px; background:#333; color:white; border:none; border-radius:6px; cursor:pointer; }
button:hover { background:#c3aab6; color:#333; }
.link { margin-top:10px; font-size:14px; }
.error { color:red; font-size:14px; }
.success { background:#4caf50; color:white; padding:12px; margin-bottom:15px; border-radius:5px; display:none; text-align:center; }
</style>
</head>

<body>

<div id="successMessage" class="success"></div>

<!-- Embedded notice (shown when page is inside an iframe) -->
<div id="embeddedNotice" style="display:none;background:#fff3cd;border:1px solid #ffeeba;color:#856404;padding:10px;margin:10px auto;max-width:420px;border-radius:6px;text-align:center;">
    This page is embedded. <a id="embeddedOpenLink" href="https://sites.google.com/view/sijuana/home/" target="_top">Open site in full window</a>
</div>

<!-- LOGIN BOX -->
<div id="loginBox" class="box">
    <h2>Login</h2>
    <input id="loginUser" type="email" placeholder="Email">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginError" class="error"></p>
    <p class="link">No account? <a href="#" onclick="showSignUp()">Sign Up</a></p>
</div>

<!-- SIGN UP BOX -->
<div id="signupBox" class="box" style="display:none;">
    <h2>Sign Up</h2>
    <input id="newFullname" type="text" placeholder="Full Name">
    <input id="newPhone" type="tel" placeholder="Phone Number">
    <input id="newUser" type="email" placeholder="Email">
    <input id="newPass" type="password" placeholder="Password">
    <button onclick="signUp()">Create Account</button>
    <p id="signupError" class="error"></p>
    <p class="link">Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<script>
// ===== Supabase Setup =====
const SUPABASE_URL = "https://vjhoahthcaojzharxbzh.supabase.co";    
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZqaG9haHRoY2FvanpoYXJ4YnpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNzY0MjEsImV4cCI6MjA4MDY1MjQyMX0.W72UylnW9DGY35S6FuaNNgSPm0biesz7CXzdxTSMbwA"; 

// Set this to your Google Sites published homepage
const HOME_PAGE = "https://sites.google.com/view/sijuana/home/";

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Toggle Boxes
function showSignUp(){ document.getElementById("signupBox").style.display="block"; document.getElementById("loginBox").style.display="none"; }
function showLogin(){ document.getElementById("signupBox").style.display="none"; document.getElementById("loginBox").style.display="block"; }

// Loading effect
function setLoading(btn,isLoading,text){ btn.disabled=isLoading; btn.innerText=isLoading?"Please wait...":text; }

// Sign Up
async function signUp(){
    let fullname=document.getElementById("newFullname").value;
    let phone=document.getElementById("newPhone").value;
    let email=document.getElementById("newUser").value;
    let password=document.getElementById("newPass").value;
    let btn=document.querySelector("#signupBox button");
    setLoading(btn,true,"Create Account");

    if(!fullname||!phone||!email||!password){ 
        document.getElementById("signupError").innerText="Fill all fields"; 
        setLoading(btn,false,"Create Account"); 
        return; 
    }

    const {data,error}=await supabaseClient.auth.signUp({email,password});
    if(error){ 
        document.getElementById("signupError").innerText=error.message; 
        setLoading(btn,false,"Create Account"); 
        return; 
    }

    document.getElementById("signupError").innerText="";
    document.getElementById("successMessage").innerText="Account created!";
    document.getElementById("successMessage").style.display="block";
    setTimeout(()=>{ document.getElementById("successMessage").style.display="none"; showLogin(); },1500);
    setLoading(btn,false,"Create Account");
}

// Login
async function login(){
    let email=document.getElementById("loginUser").value;
    let password=document.getElementById("loginPass").value;
    let btn=document.querySelector("#loginBox button");
    setLoading(btn,true,"Login");

    const {data,error}=await supabaseClient.auth.signInWithPassword({email,password});
    if(error){ 
        document.getElementById("loginError").innerText=error.message; 
        setLoading(btn,false,"Login"); 
        return; 
    }

    setLoading(btn,false,"Login");
    document.getElementById("loginError").innerText="";
    document.getElementById("successMessage").innerText="Welcome! Login successful!";
    document.getElementById("successMessage").style.display="block";

    // Redirect top-level window to Google Sites homepage
    setTimeout(()=>{ window.top.location.href = HOME_PAGE; },1000);
}

// Auto-check session
supabaseClient.auth.getSession().then(({data})=>{
    if(data.session){
        window.top.location.href = HOME_PAGE;
    }
});

// If embedded (inside an iframe), show a small notice with a top-level link
if (window.top !== window.self) {
    const note = document.getElementById('embeddedNotice');
    if (note) note.style.display = 'block';
}
</script>

</body>
</html>
